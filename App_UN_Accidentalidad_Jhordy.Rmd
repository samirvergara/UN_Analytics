---
title: "Informe Técnico de Accidentalidad"
author: "Universidad Nacional de Colombia - Especialización en Analítica"
date: "11/10/2019"
output: html_document
---

Portilla, Stefano <br>
Restrepo, Juan Esteban <br>
Sterling, Jhordy <br>
Vergara, Samir <br>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Instalar paquetes
# install.packages("Hmisc")

# Librerías usadas en este informe

library(knitr)
library(kableExtra)
library(ggplot2)
library(Hmisc)

```

### 1. Introducción
<br> <!-- Salto(s) de línea HTML -->

```{r echo=FALSE }

```
<div style="text-align: justify">

El presente informe contiene la descripcion de la accidentalidad en la ciudad de Medellín, contemplando registros de accidentes desde en año 2014 hasta el año 2019, donde se presenta información relevante como ubicación exacta de cada accidente o tipo de accidente, siendo de gran utilidad al momento de hacer análisis y tomar decisiones referentes a los accidentes en la ciudad de Medellín, los cuales con acciones acertadas pueden disminuir partiendo de la información suministrada


La ciudad de Medellín, al albergar una población que puede considerarse densa para su extensión, requiere de diversas estrategias para mitigar las diferentes problematicas que afronta cada día, entre ellas el transito vehicular. Teniendo presente que el parque automotor para la ciudad crece cada vez a mayor medida y la adecuación de vias no es suficientemente efectiva, conlleva a generar problemas como lo son los accidentes vehiculares, los cuales deben ser tenidos en cuenta al momento de crear políticas en pro de generar bienestar social, dando a los ciudadanos información de gran interés para transitar en los diferentes sectores de la ciudad.

La información de accidentalidad que contiene el actual informe, no solo permite dar a conocer el comportamiento de los accidentes en la ciudad de Medellin en los ultimos años, esta además brinda bases sobre las cuales se pueden generar nuevas estrategias para mitigar este tipo de riesgos, impactando en lo que concierne a generar bienestar en el transito vehicular para la ciudad de Medellín, y en cierta medida mejorar la movilidad al crear soluciones basadas en datos reales 

<div/>

<br>

### 2. Justificación
<br> <!-- Salto(s) de línea HTML -->

```{r echo=FALSE}

```
<div style="text-align: justify">

Para la ciudad de Medellín, se hace necesario un estudio de accidentalidad dada la cantidad de vehículos circulando en la ciudad y el impacto en tema de movilidad para cada uno de sus habitantes. Actualmente en la ciudad se encuentran en circulación alrededor de 280 mil vehículos nuevos, los cuales fueron matriculados durante el ultimo año, donde aproximadamente el 60% de estos son motos.

Para nadie es ajeno que la probabilidad de accidente de una moto es mucho mayor a la de un carro, y dado el alto porcentaje de estas en la ciudad de Medellin no es extraño que se presenten diversos accidentes cada día donde se encuentran involucrados este tipo de vehiculos, teniendo presente que estos accidentes deben ser mitigados en la medida de lo posible, ya que no solo las motos generan accidentes, por lo cual se hace necesario en primera instancia determinar la ocurrencia de estos y de este modo obtener un panorama general de su comportamiento en la ciudad, generando así una primera visualización y un punto de partida para tomar decisiones respecto a como mitigar la accidentalidad

La información presentada en el actual informe, busca servir como herramienta para aquellos que desean conocer el comportamiento de la accidentalidad en la ciudad de Medellin, ya sea para contribuir a su disminución o como fuente de información para tomar alguna decisión respecto a su propia movilidad. La información suministrada es flexible en cuanto a su usabilidad y amigable en su interpretación, sin dejar a un lado su precisión, la cual genera confiabilidad para aquellos que deseen disponer de ella y crear estrategias de acción basados en los presentes resultados.

<div/>

<br>

### 3. Objetivos
<br>

```{r}

```
<div style="text-align: justify">

* Presentar de manera clara y precisa la información de accidentalidad de la ciudad de Medellín, facilitando su interpretación mediante informes de uso práctico

* Elaborar una presentación dinámica de la accidentalidad de Medellín usando herramientas de visualización de información

* Generar conciencia en los ciudadanos de la ciudad de Medellín acerca de la responsabilidad al transitar en automóvil, partiendo de la información de accidentalidad presentada

<div/>

<br>

### 4. Datos
<br>

```{r echo=FALSE}

```

##### Datos Abiertos de Movilidad - Alcaldía de Medellín
Los datos de accidentalidad utilizados en este informe corresponden a registros entre 2014 y 2018, los cuales fueron descargados del sitio: [Alcaldía de Medellín - OpenData:  Movilidad](https://geomedellin-m-medellin.opendata.arcgis.com/search?tags=movilidad)

<br>

```{r data, echo=FALSE}

accidentalidad_2014 <- read.csv("Accidentalidad_georreferenciada_2014.csv", header = TRUE, sep = ",", encoding = "UTF-8")
accidentalidad_2015 <- read.csv("Accidentalidad_georreferenciada_2015.csv", header = TRUE, sep = ",", encoding = "UTF-8")
accidentalidad_2016 <- read.csv("Accidentalidad_georreferenciada_2016.csv", header = TRUE, sep = ",", encoding = "UTF-8")
accidentalidad_2017 <- read.csv("Accidentalidad_georreferenciada_2017.csv", header = TRUE, sep = ",", encoding = "UTF-8")
accidentalidad_2018 <- read.csv("Accidentalidad_georreferenciada_2018.csv", header = TRUE, sep = ",", encoding = "UTF-8")
#accidentalidad_2019 <- read.csv("Accidentalidad_georreferenciada_2019.csv", header = TRUE, sep = ",", encoding = "UTF-8")

all_data <- rbind(accidentalidad_2014,
                  accidentalidad_2015,
                  accidentalidad_2016,
                  accidentalidad_2017,
                  accidentalidad_2018)


all_data_variables <- subset(all_data,select = c("HORA","COMUNA","X","Y","CLASE","GRAVEDAD"))
all_data_variables$FECHA <- substr(all_data$FECHA,1,10)


```


#### 4.1 Volumetría (Número de accidentes por año y mes)
En la siguiente tabla se puede apreciar la cantidad de accidentes por año y mes en la ciudad de Medellín:
<br>

```{r regs_x_year, echo=FALSE}
all_data_regs <- table(all_data$PERIODO,all_data$MES)

```

```{r volumetria, echo=FALSE}
all_data_regs %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive", full_width = F), position = "left", font_size = 12) %>%
  footnote(general = "Archivos fuente del análisis...",
           number = c("Accidentalidad_georreferenciada_2014.csv; ", 
                      "Accidentalidad_georreferenciada_2015.csv; ",
                      "Accidentalidad_georreferenciada_2016.csv; ",
                      "Accidentalidad_georreferenciada_2017.csv; ",
                      "Accidentalidad_georreferenciada_2018.csv; "),
           general_title = "--"

           )
```

<br>
```{r echo=FALSE}

```


#### 4.2 Enriquecimiento de los datos

##### 4.2.1 Variables: LATITUD y LONGITUD
Variables usadas para georeferenciación, ubicamos la librería proj4 que nos permite convertir las coordenadas geodésicas de la fuente ("X","Y") al Sistema de coordenadas universal transversal de Mercator (UTM): ("LATITUD", "LONGITUD")

```{r lib_proj4}
library(proj4)

lib <- "+proj=tmerc +lat_0=4.596200416666666 +lon_0=-74.07750791666666 +k=1 +x_0=1000000 +y_0=1000000 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
```


```{r latitud_longitud, echo=FALSE}

# Source data
#xy <- data.frame(x=835746.06, y=1189028.44)
xy <- subset(all_data_variables,select = c("X","Y"))

# Transformed data
pj <- project(xy, lib, inverse=TRUE)

# latlon <- data.frame(LATITUD=pj$y, LONGITUD=pj$x)
# print(latlon)

# Agregar LATITUD y LONGITUD a la fuente
all_data_variables$LATITUD  <- pj$y
all_data_variables$LONGITUD <- pj$x

# Se aumenta la precisión decimal para validar las cifras
options(digits=12)

```

<br>

#### 4.3 Limpieza de datos
En algunas de las variables de análisis hemos detectado que la calidad de los datos no es la deseada, a continuación se listan las transformaciones realizadas a los datos por cada una de las variables:

<br>

##### 4.3.1 Variable: GRAVEDAD
Se mejora el formato de los datos, se pasa de MAYÚSCULAS a Mayúscula inicial:

```{r, echo=FALSE}

# Funcion para convertir   a Mayúscula inicial
firstup <- function(x) {
  substr(x, 1, 1) <- toupper(substr(x, 1, 1))
  x
}

# Formatear campo GRAVEDAD Initcap
all_data_variables$GRAVEDAD <- as.character(all_data_variables$GRAVEDAD)
all_data_variables$GRAVEDAD <- tolower(all_data_variables$GRAVEDAD)
all_data_variables$GRAVEDAD <- firstup(all_data_variables$GRAVEDAD)

# Valores únicos de GRAVEDAD
unique_gravedad <- unique(all_data_variables$GRAVEDAD)
unique_gravedad <- data.frame(unique_gravedad)
names (unique_gravedad) = c("GRAVEDAD")

unique_gravedad %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F, position = "left", font_size = 12)

```

##### 4.3.2 Variable: COMUNA
Aquí construimos una tabla de homologación, con los 85 valores disponibles en esta variable, se estandariza y se le asigna a cada valor una de las 16 comunas y 5 corregimientos de Medellín. 
Fuente Wikipedia: [Anexo:Barrios de Medellín](https://es.wikipedia.org/wiki/Anexo:Barrios_de_Medell%C3%Adn)
<br>
```{r CLASE, echo=FALSE}

comuna <-table(all_data_variables$COMUNA)
comuna <-data.frame(comuna)
names (comuna) = c("COMUNA_ORI", "FREQ")

# Descarga a CSV los datos de comuna para estandarizar los valores a sólo las 16 comunas de Medellín
write.table(comuna, dec = ".", sep="\t", row.names = FALSE , col.names = TRUE, file = "homo_comuna.csv")

```


##### 4.4 Variables de análisis
<br>
```{r variables, echo=FALSE}

#names(all_data_variables)
head(all_data_variables) %>%
  kable() %>%
  kable_styling( bootstrap_options = c("striped", "hover", "condensed", full_width = F), font_size = 12, position = "left")

```

```{r download, echo=FALSE}
# Descarga a CSV los datos que hacen parte del análisis
write.table(all_data_variables, dec = ".", sep="\t", row.names = FALSE , col.names = TRUE, file = "all_data_variables.csv")

```

### 5. Presentación

##### Interfaz dinámica
<br>
![Accidentalidad en Medellín](C:\Users\Jhordy Sterling\Documents\Especializacion analitica\Ciencia de los datos\Project\Shiny.JPG "Accidentalidad en Medellín")
<br>

La anterior imagen ilustra el modelo interfaz sobre el cual es posible consultar la siniestralidad en la ciudad de Medellín, esto a partir de segmentación de datos que pueden ser combinados libremente pos los usuarios


<!-- #### 5.1 Mapa de calor de accidentalidad por año y mes -->
<!-- A continuación vemos una representación gráfica por años en la que se visualizan los meses donde más se focalizan los accidentes en la ciudad de Medellín -->

```{r headmap, include=FALSE}
image(t(all_data_regs[1:5,]),
      col = hcl.colors(12, palette = "Reds", rev = TRUE),
      xlab = "Meses",
      ylab = "Años",
      axes=F,
      main = "Accidentalidad - Mapa de calor",
      cex.main=0.9,
      cex.lab = 0.8)
#axis(1, at=seq(0, 1, length.out = 12), labels = colnames(all_data_regs))
axis(1, at=seq(0, 1, length.out = 12), labels = c("Ene", "Feb", "Mar", "Abr", "May", "Jun",
                                                  "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"),las=2, cex.axis = 0.8)
axis(2, at=seq(0, 1, length.out = 5 ), labels = rownames(all_data_regs), las=1, cex.axis = 0.8)
```

<br>

```{r, echo=FALSE}

```

### 6. Conclusiones

<br>

```{r, echo=FALSE}

```
<div style="text-align: justify">

Con la información presentada sobre la accidentalidad en la ciudad de Medellin, se logran identificar parametros importantes que sirven de referencia al momento de tomar medidas de precaución frente a este tipo de riesgos, ya que se muestran indicadores de accidentes en diferentes modalidades de tiempo, localización y severidad, los cuales sirven como punto de partida en la definicion de criterios para la articulación de posibles soluciones asociadas a la accidentalidad

La presentación de la información se logra efectuar de forma clara y dinámica, de manera que pueda ser interpretada por la mayoria de las personas de la ciudad de Medellín, ya que son los principales beneficiarios y en primera instancia quienes toman decisiones propias al momento de salir a circular en vehículos dentro de la ciudad de Medellín

La información presentada sobre accidentalidad en la ciudad de Medellin, genera un efecto considerable en cuanto a conocimiento general del comportamiento de los accidentes en la ciudad, y a su vez sirve de herramienta informativa para tomar precauciones al momento de transitar en la ciudad e Medellín, ya sea con o sin un vehículo

<div/>

### 7. Bibliografía

<br>

* El portal de datos de Medellín: [Medata](http://medata.gov.co/)

* Alcaldía de Medellín: [Secretaría de movilidad de Medellín](https://www.medellin.gov.co/movilidad/cifras-estudios/viewcategory/1872-parque-automotor)

* Periódico El Tiempo: [El Tiempo](https://www.eltiempo.com/colombia/medellin/el-valle-de-aburra-supero-las-900-000-motos-matriculadas-343266)

* Revista Dinero: [Dinero](https://www.dinero.com/economia/articulo/cuantos-carros-y-motos-se-vendieron-en-enero-de-2019/266687)

* Alianza interinstitucional [Medellín cómo vamos](https://www.medellincomovamos.org/la-ciudad/)

* Wikipedia [Barrios de Medellín](https://es.wikipedia.org/wiki/Anexo:Barrios_de_Medell%C3%ADn)


<br>

```{r echo=FALSE}

# names(all_data_variables)
# head(all_data_variables)
# unique(all_data_variables$COMUNA)
# table(all_data_variables$COMUNA)

```

